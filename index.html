<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema CRM Restaurante</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <span>CRM Restaurante</span>
                </div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-pie"></i>
                    <span>Panel Principal</span>
                </li>
                <li class="nav-item" data-page="tables">
                    <i class="fas fa-table"></i>
                    <span>Mesas</span>
                </li>
                <li class="nav-item" data-page="menu">
                    <i class="fas fa-book"></i>
                    <span>Menú</span>
                </li>
                <li class="nav-item" data-page="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Pedidos</span>
                </li>
                <li class="nav-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h1>Panel Principal</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="refreshData">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Quick Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="totalSales">$0.00</h3>
                                <p>Ventas de Hoy</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-table"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="activeTables">0</h3>
                                <p>Mesas Activas</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="popularDish">-</h3>
                                <p>Más Popular</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="avgOrderTime">-</h3>
                                <p>Tiempo Promedio</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tables Overview -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Estado de Mesas</h2>
                        </div>
                        <div class="card-content">
                            <div class="tables-overview" id="tablesOverview">
                                <!-- Tables will be dynamically loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Actividad Reciente</h2>
                        </div>
                        <div class="card-content">
                            <div class="activity-list" id="recentActivity">
                                <!-- Activity items will be dynamically loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tables Page -->
            <div id="tables" class="page">
                <div class="page-header">
                    <h1>Gestión de Mesas</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="addTableBtn">
                            <i class="fas fa-plus"></i>
                            Agregar Mesa
                        </button>
                    </div>
                </div>

                <div class="tables-grid" id="tablesGrid">
                    <!-- Tables will be dynamically loaded here -->
                </div>
            </div>

            <!-- Menu Page -->
            <div id="menu" class="page">
                <div class="page-header">
                    <h1>Gestión de Menú</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="addMenuItemBtn">
                            <i class="fas fa-plus"></i>
                            Agregar Item
                        </button>
                    </div>
                </div>

                <div class="menu-categories">
                    <div class="category-tabs" id="categoryTabs">
                        <!-- Categories will be dynamically loaded here -->
                    </div>
                    <div class="menu-items" id="menuItems">
                        <!-- Menu items will be dynamically loaded here -->
                    </div>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="orders" class="page">
                <div class="page-header">
                    <h1>Gestión de Pedidos</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="crm.openManualInvoiceModal()">
                            <i class="fas fa-file-invoice"></i>
                            Facturación Manual
                        </button>
                    </div>
                </div>

                <div class="orders-container">
                    <div class="tables-selector">
                        <h3>Seleccionar Mesa</h3>
                        <div class="tables-list" id="ordersTablesList">
                            <!-- Tables for orders will be loaded here -->
                        </div>
                    </div>
                    <div class="order-details" id="orderDetails">
                        <div class="no-selection">
                            <i class="fas fa-table"></i>
                            <p>Selecciona una mesa para ver pedidos</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="reports" class="page">
                <div class="page-header">
                    <h1>Reportes y Análisis</h1>
                    <div class="header-actions">
                        <select id="reportPeriod" class="form-select">
                            <option value="today">Hoy</option>
                            <option value="week">Esta Semana</option>
                            <option value="month">Este Mes</option>
                        </select>
                        <button class="btn btn-secondary" id="exportReportBtn">
                            <i class="fas fa-download"></i>
                            Exportar PDF
                        </button>
                    </div>
                </div>

                <div class="reports-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>Resumen de Ventas</h2>
                        </div>
                        <div class="card-content">
                            <div class="sales-summary" id="salesSummary">
                                <!-- Sales summary will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Items Más Vendidos</h2>
                        </div>
                        <div class="card-content">
                            <div class="top-items" id="topItems">
                                <!-- Top items will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2>Desglose por Categoría</h2>
                        </div>
                        <div class="card-content">
                            <div class="category-breakdown" id="categoryBreakdown">
                                <!-- Category breakdown will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1>Configuración</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="crm.lockConfiguration()">
                            <i class="fas fa-lock"></i>
                            Cerrar Sesión
                        </button>
                    </div>
                </div>

                <div class="settings-container">
                    <div class="card">
                        <div class="card-header">
                            <h2>Información del Restaurante</h2>
                        </div>
                        <div class="card-content">
                            <form id="restaurantSettings">
                                <div class="form-group">
                                    <label for="restaurantName">Nombre del Restaurante</label>
                                    <input type="text" id="restaurantName" class="form-input" placeholder="Ingrese el nombre del restaurante">
                                </div>
                                <div class="form-group">
                                    <label for="invoicePrefix">Prefijo de Factura</label>
                                    <input type="text" id="invoicePrefix" class="form-input" placeholder="Ej: FAC-001" maxlength="10">
                                </div>
                                <div class="form-group">
                                    <label for="currency">Moneda</label>
                                    <select id="currency" class="form-select">
                                        <option value="ARS">ARS ($)</option>
                                        <option value="USD">USD ($)</option>
                                        <option value="EUR">EUR (€)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="taxRate">Tasa de Impuesto (%)</label>
                                    <input type="number" id="taxRate" class="form-input" placeholder="0.00" step="0.01" min="0" max="100">
                                </div>
                                <div class="form-group">
                                    <label for="openingTime">Hora de Apertura</label>
                                    <input type="time" id="openingTime" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="closingTime">Hora de Cierre</label>
                                    <input type="time" id="closingTime" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">Nueva Contraseña</label>
                                    <input type="password" id="newPassword" class="form-input" placeholder="Dejar vacío para mantener la actual">
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">Confirmar Contraseña</label>
                                    <input type="password" id="confirmPassword" class="form-input" placeholder="Repetir nueva contraseña">
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Configuración</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="addTableModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Nueva Mesa</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addTableForm">
                    <div class="form-group">
                        <label for="tableNumber">Número de Mesa</label>
                        <input type="text" id="tableNumber" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="tableCapacity">Capacidad</label>
                        <input type="number" id="tableCapacity" class="form-input" min="1" max="20" required>
                    </div>
                    <div class="form-group">
                        <label for="tableLocation">Ubicación</label>
                        <input type="text" id="tableLocation" class="form-input" placeholder="Ej: Comedor Principal, Patio">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                <button type="submit" form="addTableForm" class="btn btn-primary">Agregar Mesa</button>
            </div>
        </div>
    </div>

    <div id="addMenuItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Item del Menú</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMenuItemForm">
                    <div class="form-group">
                        <label for="itemName">Nombre del Item</label>
                        <input type="text" id="itemName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="itemCategory">Categoría</label>
                        <select id="itemCategory" class="form-select" required>
                            <option value="entradas">Entradas</option>
                            <option value="platos">Platos Principales</option>
                            <option value="postres">Postres</option>
                            <option value="bebidas">Bebidas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="itemPrice">Precio</label>
                        <input type="number" id="itemPrice" class="form-input" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="itemDescription">Descripción</label>
                        <textarea id="itemDescription" class="form-input" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="itemAvailable" checked>
                            <span class="checkmark"></span>
                            Disponible
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                <button type="submit" form="addMenuItemForm" class="btn btn-primary">Agregar Item</button>
            </div>
        </div>
    </div>

    <div id="orderModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Pedido de Mesa</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-container">
                    <div class="menu-section">
                        <h3>Items del Menú</h3>
                        <div class="menu-items-list" id="orderMenuItems">
                            <!-- Menu items for ordering will be loaded here -->
                        </div>
                    </div>
                    <div class="order-section">
                        <h3>Pedido Actual</h3>
                        <div class="order-items" id="currentOrderItems">
                            <!-- Current order items will be loaded here -->
                        </div>
                        <div class="order-total">
                            <div class="total-line">
                                <span>Subtotal:</span>
                                <span id="orderSubtotal">$0.00</span>
                            </div>
                            <div class="total-line">
                                <span>Impuesto:</span>
                                <span id="orderTax">$0.00</span>
                            </div>
                            <div class="total-line total">
                                <span>Total:</span>
                                <span id="orderTotal">$0.00</span>
                            </div>
                        </div>
                        <div class="order-actions">
                            <button class="btn btn-primary" id="placeOrderBtn">Realizar Pedido</button>
                            <button class="btn btn-secondary" id="clearOrderBtn">Limpiar Pedido</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Contraseña para Configuración -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Acceso a Configuración</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="password-container">
                    <div class="password-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <p>Ingrese la contraseña para acceder a la configuración:</p>
                    <form id="passwordForm">
                        <div class="form-group">
                            <input type="password" id="passwordInput" class="form-input" placeholder="Contraseña" required>
                        </div>
                        <div id="passwordError" class="error-message" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Contraseña incorrecta. Intente nuevamente.
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                <button type="submit" form="passwordForm" class="btn btn-primary">Acceder</button>
            </div>
        </div>
    </div>

    <!-- Modal de Facturación Manual -->
    <div id="manualInvoiceModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Facturación Manual</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="manual-invoice-container">
                    <div class="invoice-options">
                        <h3>Seleccione el tipo de facturación:</h3>
                        <div class="invoice-type-buttons">
                            <button class="btn btn-primary" onclick="crm.showManualItems()">
                                <i class="fas fa-plus"></i>
                                Producto Manual
                            </button>
                            <button class="btn btn-secondary" onclick="crm.showExistingItems()">
                                <i class="fas fa-list"></i>
                                Productos Existentes
                            </button>
                        </div>
                    </div>
                    
                    <div id="manualItemsSection" class="invoice-section" style="display: none;">
                        <h3>Agregar Producto Manual</h3>
                        <form id="manualItemForm">
                            <div class="form-group">
                                <label for="manualItemName">Descripción del Producto</label>
                                <input type="text" id="manualItemName" class="form-input" placeholder="Ej: Servicio de delivery" required>
                            </div>
                            <div class="form-group">
                                <label for="manualItemPrice">Precio</label>
                                <input type="number" id="manualItemPrice" class="form-input" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="manualItemQuantity">Cantidad</label>
                                <input type="number" id="manualItemQuantity" class="form-input" min="1" value="1" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Agregar a Factura</button>
                        </form>
                    </div>

                    <div id="existingItemsSection" class="invoice-section" style="display: none;">
                        <h3>Seleccionar Productos Existentes</h3>
                        <div class="existing-items-list" id="existingItemsList">
                            <!-- Items existentes se cargarán aquí -->
                        </div>
                    </div>

                    <div class="manual-invoice-items">
                        <h3>Items de la Factura</h3>
                        <div class="manual-items-list" id="manualItemsList">
                            <p style="text-align: center; color: rgba(255,255,255,0.6);">No hay items agregados</p>
                        </div>
                        <div class="manual-total">
                            <div class="total-line">
                                <span>Subtotal:</span>
                                <span id="manualSubtotal">$0.00</span>
                            </div>
                            <div class="total-line">
                                <span>Impuesto:</span>
                                <span id="manualTax">$0.00</span>
                            </div>
                            <div class="total-line total">
                                <span>Total:</span>
                                <span id="manualTotal">$0.00</span>
                            </div>
                        </div>
                        <div class="manual-actions">
                            <button class="btn btn-primary" id="generateManualInvoiceBtn" disabled>Generar Factura</button>
                            <button class="btn btn-secondary" id="clearManualItemsBtn">Limpiar Todo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Facturación Completa de Mesa -->
    <div id="fullTableInvoiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Facturar Mesa Completa</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="full-invoice-container">
                    <p>¿Desea facturar todos los pedidos pendientes de la mesa <strong id="fullInvoiceTableNumber"></strong>?</p>
                    <div class="invoice-summary" id="fullInvoiceSummary">
                        <!-- Resumen de la factura se cargará aquí -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                <button class="btn btn-primary" id="confirmFullInvoiceBtn">Confirmar Facturación</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
